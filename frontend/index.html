<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LSM-Tree Key-Value Store Prototype</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
    <script defer src="app.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">LSM Prototype</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu" aria-controls="navMenu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navMenu">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
          </ul>
          <span class="navbar-text text-white">Simple LSM key-value store</span>
        </div>
      </div>
    </nav>

    <main class="container my-4">
      <div class="dashboard-grid">
        <!-- Top left: Write / Update (PUT) -->
        <div class="card p-3" id="putCard">
          <h5 class="card-title">Write / Update (PUT)</h5>
          <form id="putForm" class="row g-2 align-items-end">
            <div class="col-sm-5">
              <label class="form-label">Key (optional)</label>
              <input class="form-control" type="text" id="putKey" placeholder="Leave empty to auto-generate a key" />
            </div>
            <div class="col-sm-5">
              <label class="form-label">Value</label>
              <input class="form-control" type="text" id="putValue" required placeholder='Enter value (e.g., "hello", "student1")' />
            </div>
            <div class="col-sm-2 d-grid">
              <button class="btn btn-primary" type="submit">PUT</button>
            </div>
          </form>
          <pre id="putResult" class="result mt-3"></pre>
          <div id="putStatus" class="status-message mt-2" aria-live="polite"></div>
        </div>

        <!-- Top right: Read (GET) -->
        <div class="card p-3" id="getCard">
          <h5 class="card-title">Read (GET)</h5>
          <form id="getForm" class="row g-2 align-items-end">
            <div class="col-sm-9">
              <label class="form-label">Key</label>
              <input class="form-control" type="text" id="getKey" placeholder="Enter key to read (e.g., 12a17f49-...)" required />
            </div>
            <div class="col-sm-3 d-grid">
              <button class="btn btn-secondary" type="submit">GET</button>
            </div>
          </form>
          <pre id="getResult" class="result mt-3"></pre>
          <div id="getValueDisplay" class="status-message mt-2" aria-live="polite"></div>
        </div>

        <!-- Middle: Storage Status & Controls (spans full width) -->
        <div class="card p-3 storage-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="card-title mb-0">Storage Status & Controls</h5>
            <div class="d-flex gap-2 align-items-center">
              <button id="refreshStats" class="btn btn-outline-primary btn-sm">Refresh</button>
              <button id="compactBtn" class="btn btn-outline-danger btn-sm" disabled>Compact (dev)</button>
              <!-- keep side IDs so existing app.js bindings still work -->
              <button id="refreshStatsSide" class="btn btn-outline-primary btn-sm d-none">Refresh (side)</button>
              <button id="compactBtnSide" class="btn btn-outline-danger btn-sm d-none" disabled>Compact (side)</button>
            </div>
          </div>
          <p class="card-text mb-2">Current memtable size and SST file count.</p>
          <div class="stats">
            <div>Memtable Size: <strong id="memtableSize">-</strong></div>
            <div>SST Files: <strong id="sstCount">-</strong></div>
            <div class="muted">(replicated IDs for compatibility)</div>
            <div style="display:none">MemtableSide: <strong id="memtableSizeSide">-</strong></div>
            <div style="display:none">SSTSide: <strong id="sstCountSide">-</strong></div>
          </div>
        </div>

        <!-- Bottom left: Keys table -->
        <div class="card p-3" id="keysSection">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="card-title mb-0">Keys</h5>
            <div class="d-flex gap-2 align-items-center">
              <input class="form-control form-control-sm" type="text" id="keysFilter" placeholder="search substring" />
              <button id="refreshKeys" class="btn btn-sm btn-primary">Refresh</button>
            </div>
          </div>

          <div class="table-responsive keys-scroll">
            <table id="keysTable" class="table table-striped mb-0">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Value</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="d-flex gap-2 align-items-center mt-2">
            <button id="prevKeys" class="btn btn-sm btn-outline-secondary">Prev</button>
            <div>Page <span id="keysPage">1</span></div>
            <button id="nextKeys" class="btn btn-sm btn-outline-secondary">Next</button>
          </div>
        </div>

        <!-- Bottom right: Recent Activity (Filters / Logs placeholder) -->
        <div class="card p-3 placeholder-card">
          <h6 class="card-title">Recent Activity</h6>
          <p class="muted small">Last operations (client-side activity log)</p>
          <ul id="recentActivity" class="recent-list">
            <!-- recent activity items inserted here by app.js -->
          </ul>
          <div style="margin-top:8px;">
            <button id="simulateCompact" class="btn btn-sm btn-outline-secondary">Simulate COMPACT</button>
          </div>
        </div>
      </div>
    </main>

    <!-- Toast container -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
      <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
          <strong class="me-auto" id="toastTitle">Notification</strong>
          <small class="text-muted">now</small>
          <button type="button" class="btn-close ms-2 mb-1" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastBody">
        </div>
      </div>
    </div>

    <!-- Bootstrap JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
